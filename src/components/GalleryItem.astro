---
import SmartImage from "./SmartImage.astro";

const {
  image,
  title = "",
  director = "",
  placeAndYear = "",
  slug = "",
  category = "",
  loading = "lazy",
} = Astro.props;

// Optional portrait rule (narrower media)
const dims = image?.assetDoc?.metadata?.dimensions;
const w = dims?.width;
const h = dims?.height;
const isPortrait = !!(w && h && h / w > 1.15);
---

<a href={`/${category}/${slug}`} class={`item ${isPortrait ? "portrait" : ""}`}>
  <div class="media">
    <SmartImage
      image={image}
      alt={title}
      loading={loading}
      fit="cover"
      bg="#fff"
    />
  </div>

  <p class="details">
    <span class="title">{title}</span>
    <span class="meta">
      {`${director}${placeAndYear && ","} ${placeAndYear}`}
    </span>
  </p>
</a>

<style lang="scss">
  .item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
    text-decoration: none;
    color: inherit;

    /* Mobile tap highlight can look like a flash */
    -webkit-tap-highlight-color: transparent;
  }

  .media {
    width: 100%;
  }

  /* Optional portrait treatment (desktop) */
  .item.portrait .media {
    width: 60%;
  }

  /* On mobile, let portraits use full width */
  @media (max-width: 768px) {
    .item.portrait .media {
      width: 100%;
    }
  }

  .details {
    margin: 0;
    line-height: 1.2;
    display: flex;
    gap: 30px;
    justify-content: space-between;
  }

  .title,
  .meta {
    display: block;
  }

  /* Prevent dimming on click/tap */
  .item,
  .item:active,
  .item:focus,
  .item:focus-visible {
    opacity: 1 !important;
  }

  /* If you have hover dimming, keep it off for the image */
  .item:hover .smart-media,
  .item:active .smart-media,
  .item:focus-visible .smart-media {
    opacity: 1 !important;
  }
</style>
