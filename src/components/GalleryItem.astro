---
import SmartImage from "./SmartImage.astro";

const {
  image,
  title = "",
  director = "",
  placeAndYear = "",
  slug = "",
  category = "",
  loading = "lazy",
} = Astro.props;

// Optional portrait rule (narrower media)
const dims = image?.assetDoc?.metadata?.dimensions;
const w = dims?.width;
const h = dims?.height;
const isPortrait = !!(w && h && h / w > 1.15);
---

<a href={`/${category}/${slug}`} class={`item ${isPortrait ? "portrait" : ""}`}>
  <div class="media">
    <SmartImage
      image={image}
      alt={title}
      loading={loading}
      fit="cover"
      bg="#fff"
    />
  </div>

  <p class="details">
    <span class="title">{title}</span>
    <span class="meta">
      {`${director}${placeAndYear && ","} ${placeAndYear}`}
    </span>
  </p>
</a>

<style lang="scss">
  .item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    width: 100%;
    text-decoration: none;
    color: inherit;
  }

  .media {
    width: 100%;
  }

  /* Optional portrait treatment */
  .item.portrait .media {
    width: 60%;
  }

  .details {
    margin: 0;
    line-height: 1.2;
    display: flex;
    justify-content: space-between;
  }

  .title {
    display: block;
  }

  .meta {
    display: block;
  }

  /* Prevent dimming on click/tap */
  .item,
  .item:active,
  .item:focus,
  .item:focus-visible {
    opacity: 1 !important;
  }

  /* If you have hover dimming, keep it off for the image */
  .item:hover .smart-media,
  .item:active .smart-media,
  .item:focus-visible .smart-media {
    opacity: 1 !important;
  }

  /* Mobile tap highlight can look like a flash */
  .item {
    -webkit-tap-highlight-color: transparent;
  }
</style>
