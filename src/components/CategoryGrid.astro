---
import GalleryItem from "./GalleryItem.astro";

const { projects = [] } = Astro.props;

const count = projects.length;
const COPIES = 5;
const centerCopy = Math.floor(COPIES / 2);
const centerStart = centerCopy * count;
const centerEnd = centerStart + count;
const repeated = count
  ? Array.from({ length: COPIES }, () => projects).flat()
  : [];
---

<div class="gallery-wrapper">
  <section
    class="grid"
    data-infinite-snap="1"
    data-count={count}
    data-copies={COPIES}
  >
    {
      repeated.map((project, i) => (
        <div class="snap-item" data-idx={i}>
          <GalleryItem
            image={project.coverImage}
            title={project.title ?? ""}
            director={project.director ?? ""}
            placeAndYear={project.placeAndYear ?? ""}
            slug={project.slug ?? ""}
            caption={project.caption ?? ""}
            category={project.category ?? ""}
            loading={i >= centerStart && i < centerEnd ? "eager" : "lazy"}
          />
        </div>
      ))
    }
  </section>
</div>

<style lang="scss">
  /* No need to @import variables for layout values anymore
     (assuming you defined :root CSS vars globally). */

  :global(html),
  :global(body) {
    height: 100%;
    overflow: hidden;
  }

  .gallery-wrapper {
    position: fixed;
    inset: 0;
    width: 100vw;
  }

  .grid {
    height: 100%;
    width: 100%;
    overflow-y: auto;

    display: flex;
    flex-direction: column;

    scrollbar-width: none;
    scroll-snap-type: y mandatory;
    overscroll-behavior: contain;
    scroll-behavior: auto;
  }

  .snap-item {
    scroll-snap-align: center;
    scroll-snap-stop: always;

    width: 100%;
    display: block;
    padding-block: var(--lh);
  }

  /* The actual card/anchor should be limited to the content width */
  .snap-item :global(.item) {
    width: var(--content-width);
    margin-left: var(--content-left);
    margin-right: 0;
  }

  /* If you already override vars in :root for mobile,
     you can keep this empty or remove it entirely.
     Keeping it only if you want extra tweaks beyond the vars. */
  @media (max-width: 768px) {
    .snap-item :global(.item) {
      width: var(--content-width);
      margin-left: var(--content-left);
    }
  }
</style>
